<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TradeX Platform Onboarding{% endblock %}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Dark Mode Detection with Manual Toggle -->
    <script>
        // Check for saved theme preference or default to system preference
        const getThemePreference = () => {
            const saved = localStorage.getItem('theme');
            if (saved) return saved;
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        };

        const setTheme = (theme) => {
            document.documentElement.classList.remove('light', 'dark');
            document.documentElement.classList.add(theme);
            localStorage.setItem('theme', theme);
        };

        // Set initial theme
        setTheme(getThemePreference());

        // Toggle theme function (will be called by button)
        window.toggleTheme = () => {
            const current = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            const next = current === 'dark' ? 'light' : 'dark';
            setTheme(next);
        };
    </script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        popover: {
                            DEFAULT: "hsl(var(--popover))",
                            foreground: "hsl(var(--popover-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    },
                    borderRadius: {
                        lg: "0.5rem",
                        md: "calc(0.5rem - 2px)",
                        sm: "calc(0.5rem - 4px)",
                    },
                }
            }
        }
    </script>

    <style>
        [x-cloak] {
            display: none !important;
        }

        /* CSS Variables for light and dark mode */
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 221.2 83.2% 53.3%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --success: 142.1 76.2% 36.3%;
            --success-foreground: 142.1 100% 97%;
            --border: 214.3 31.8% 95%;
            --input: 214.3 31.8% 91.4%;
            --ring: 221.2 83.2% 53.3%;
        }

        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --popover: 222.2 84% 4.9%;
            --popover-foreground: 210 40% 98%;
            --primary: 217.2 91.2% 59.8%;
            --primary-foreground: 222.2 47.4% 11.2%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --success: 142.1 70% 33%;
            --success-foreground: 210 40% 98%;
            --border: 217.2 32.6% 12%;
            --input: 217.2 32.6% 17.5%;
            --ring: 224.3 76.3% 48%;
        }

        /* Base styles with dark mode support */
        html,
        body {
            height: 100%;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        /* shadcn/ui inspired component styles - using CSS variables */
        .btn {
            --btn-bg: transparent;
            --btn-border: transparent;
            --btn-text: hsl(var(--foreground));
            --btn-bg-hover: hsl(var(--accent));
            --btn-text-hover: hsl(var(--accent-foreground));
            --btn-border-hover: var(--btn-border);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            height: 2.75rem;
            padding: 0.5rem 1.5rem;
            cursor: pointer;
            white-space: nowrap;
            background-color: var(--btn-bg);
            color: var(--btn-text);
            border: 1px solid var(--btn-border);
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: 0 0 0 2px hsl(var(--ring));
        }

        .btn:disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .btn:hover {
            background-color: var(--btn-bg-hover);
            color: var(--btn-text-hover);
            border-color: var(--btn-border-hover);
        }

        .btn-primary {
            --btn-bg: hsl(var(--primary));
            --btn-border: hsl(var(--primary));
            --btn-text: hsl(var(--primary-foreground));
            --btn-bg-hover: hsl(var(--primary) / 0.9);
            --btn-text-hover: hsl(var(--primary-foreground));
            --btn-border-hover: hsl(var(--primary));
        }

        .btn-outline {
            --btn-bg: transparent;
            --btn-border: hsl(var(--primary));
            --btn-text: hsl(var(--primary));
            --btn-bg-hover: hsl(var(--primary) / 0.12);
            --btn-text-hover: hsl(var(--primary));
            --btn-border-hover: hsl(var(--primary));
        }

        .btn-muted {
            --btn-bg: hsl(var(--muted));
            --btn-border: hsl(var(--border));
            --btn-text: hsl(var(--muted-foreground));
            --btn-bg-hover: hsl(var(--muted) / 0.9);
            --btn-text-hover: hsl(var(--muted-foreground));
            --btn-border-hover: hsl(var(--border));
        }

        .btn[data-tone="danger"] {
            --btn-border: hsl(var(--destructive));
            --btn-text: hsl(var(--destructive));
            --btn-bg-hover: hsl(var(--destructive) / 0.12);
            --btn-text-hover: hsl(var(--destructive));
            --btn-border-hover: hsl(var(--destructive));
        }

        .btn-primary[data-tone="danger"] {
            --btn-bg: hsl(var(--destructive));
            --btn-border: hsl(var(--destructive));
            --btn-text: hsl(var(--destructive-foreground));
            --btn-bg-hover: hsl(var(--destructive) / 0.9);
            --btn-text-hover: hsl(var(--destructive-foreground));
            --btn-border-hover: hsl(var(--destructive));
        }

        .btn[data-tone="success"] {
            --btn-border: hsl(var(--success));
            --btn-text: hsl(var(--success));
            --btn-bg-hover: hsl(var(--success) / 0.12);
            --btn-text-hover: hsl(var(--success));
            --btn-border-hover: hsl(var(--success));
        }

        .btn-primary[data-tone="success"] {
            --btn-bg: hsl(var(--success));
            --btn-border: hsl(var(--success));
            --btn-text: hsl(var(--success-foreground));
            --btn-bg-hover: hsl(var(--success) / 0.9);
            --btn-text-hover: hsl(var(--success-foreground));
            --btn-border-hover: hsl(var(--success));
        }

        .btn-icon {
            --btn-bg: transparent;
            --btn-border: transparent;
            --btn-text: hsl(var(--muted-foreground));
            --btn-bg-hover: hsl(var(--muted) / 0.6);
            --btn-text-hover: hsl(var(--foreground));
            --btn-border-hover: transparent;
            color: var(--btn-text);
            border-color: transparent;
        }

        .card {
            border-radius: 0.5rem;
            border: 1px solid hsl(var(--border));
            background-color: hsl(var(--card));
            color: hsl(var(--card-foreground));
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.08);
        }

        .input {
            display: flex;
            height: 2.5rem;
            width: 100%;
            border-radius: 0.375rem;
            border: 1px solid hsl(var(--border));
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }

        .input::placeholder {
            color: hsl(var(--muted-foreground));
        }

        .input:focus-visible {
            outline: none;
            box-shadow: 0 0 0 2px hsl(var(--ring));
        }

        .input:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            border-radius: 9999px;
            border: 1px solid;
            padding: 0.125rem 0.625rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .container {
            width: 100%;
            max-width: 1280px;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }
    </style>

    <!-- SweetAlert2 Custom Configuration -->
    <script>
        // Custom SweetAlert2 configuration for consistent theme
        window.showSuccess = (message, title = 'Success') => {
            return Swal.fire({
                icon: 'success',
                title: title,
                text: message,
                confirmButtonColor: 'hsl(142.1 76.2% 36.3%)',
                background: document.documentElement.classList.contains('dark') ? 'hsl(222.2 84% 4.9%)' : '#fff',
                color: document.documentElement.classList.contains('dark') ? 'hsl(210 40% 98%)' : 'hsl(222.2 84% 4.9%)',
            });
        };

        window.showError = (message, title = 'Error') => {
            return Swal.fire({
                icon: 'error',
                title: title,
                text: message,
                confirmButtonColor: 'hsl(0 84.2% 60.2%)',
                background: document.documentElement.classList.contains('dark') ? 'hsl(222.2 84% 4.9%)' : '#fff',
                color: document.documentElement.classList.contains('dark') ? 'hsl(210 40% 98%)' : 'hsl(222.2 84% 4.9%)',
            });
        };

        window.showWarning = (message, title = 'Warning') => {
            return Swal.fire({
                icon: 'warning',
                title: title,
                text: message,
                confirmButtonColor: 'hsl(24.6 95% 53.1%)',
                background: document.documentElement.classList.contains('dark') ? 'hsl(222.2 84% 4.9%)' : '#fff',
                color: document.documentElement.classList.contains('dark') ? 'hsl(210 40% 98%)' : 'hsl(222.2 84% 4.9%)',
            });
        };

        window.showInfo = (message, title = 'Info') => {
            return Swal.fire({
                icon: 'info',
                title: title,
                text: message,
                confirmButtonColor: 'hsl(221.2 83.2% 53.3%)',
                background: document.documentElement.classList.contains('dark') ? 'hsl(222.2 84% 4.9%)' : '#fff',
                color: document.documentElement.classList.contains('dark') ? 'hsl(210 40% 98%)' : 'hsl(222.2 84% 4.9%)',
            });
        };

        window.showConfirm = (options) => {
            const defaultOptions = {
                title: 'Are you sure?',
                text: options.text || '',
                icon: options.icon || 'question',
                showCancelButton: true,
                confirmButtonText: options.confirmButtonText || 'Yes',
                cancelButtonText: options.cancelButtonText || 'No',
                confirmButtonColor: 'hsl(142.1 76.2% 36.3%)',
                cancelButtonColor: 'hsl(0 84.2% 60.2%)',
                background: document.documentElement.classList.contains('dark') ? 'hsl(222.2 84% 4.9%)' : '#fff',
                color: document.documentElement.classList.contains('dark') ? 'hsl(210 40% 98%)' : 'hsl(222.2 84% 4.9%)',
                reverseButtons: true
            };
            return Swal.fire({ ...defaultOptions, ...options });
        };

        window.showPrompt = (options) => {
            const defaultOptions = {
                title: options.title || 'Input required',
                input: options.inputType || 'text',
                inputLabel: options.inputLabel || '',
                inputPlaceholder: options.inputPlaceholder || '',
                inputValue: options.inputValue || '',
                showCancelButton: true,
                confirmButtonText: options.confirmButtonText || 'Submit',
                cancelButtonText: options.cancelButtonText || 'Cancel',
                confirmButtonColor: 'hsl(142.1 76.2% 36.3%)',
                cancelButtonColor: 'hsl(0 84.2% 60.2%)',
                background: document.documentElement.classList.contains('dark') ? 'hsl(222.2 84% 4.9%)' : '#fff',
                color: document.documentElement.classList.contains('dark') ? 'hsl(210 40% 98%)' : 'hsl(222.2 84% 4.9%)',
                reverseButtons: true,
                inputValidator: options.inputValidator || ((value) => {
                    if (!value) {
                        return 'This field is required';
                    }
                })
            };
            return Swal.fire({ ...defaultOptions, ...options });
        };

        window.showTextarea = (options) => {
            return showPrompt({
                inputType: 'textarea',
                ...options
            });
        };
    </script>

    {% block extra_head %}{% endblock %}
</head>

<body class="bg-background text-foreground font-sans antialiased">
    <!-- Header -->
    {% if current_user %}
    <header
        class="sticky top-0 z-50 w-full border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div class="container flex h-14 items-center">
            <div class="mr-4 hidden md:flex items-center">
                <a href="{{ url_for('web.dashboard') }}" class="mr-4 flex items-center space-x-2">
                    <span class="font-bold text-xl text-foreground">TradeX</span>
                    <span class="text-muted-foreground">Platform Onboarding</span>
                </a>
                <div class="h-6 w-px bg-border mx-2"></div>
                <nav class="flex items-center space-x-6 text-sm font-medium ml-4">
                    <a href="{{ url_for('web.dashboard') }}"
                        class="transition-colors hover:text-foreground/80 {{ 'text-foreground' if request.endpoint == 'web.dashboard' else 'text-muted-foreground' }}">
                        Dashboard
                    </a>
                    <a href="{{ url_for('web.new_request') }}"
                        class="transition-colors hover:text-foreground/80 {{ 'text-foreground' if request.endpoint == 'web.new_request' else 'text-muted-foreground' }}">
                        New Request
                    </a>
                    <a href="{{ url_for('web.requests_list') }}"
                        class="transition-colors hover:text-foreground/80 {{ 'text-foreground' if request.endpoint in ['web.requests_list', 'web.request_detail'] else 'text-muted-foreground' }}">
                        My Requests
                    </a>
                    {% if is_admin %}
                    <a href="{{ url_for('web.admin_panel') }}"
                        class="transition-colors hover:text-foreground/80 {{ 'text-foreground' if request.endpoint in ['web.admin_panel', 'web.admin_lookup'] else 'text-muted-foreground' }}">
                        Admin
                    </a>
                    {% endif %}
                </nav>
            </div>
            <div class="flex md:hidden">
                <a href="{{ url_for('web.dashboard') }}" class="flex items-center space-x-2">
                    <span class="font-bold text-xl text-foreground">TradeX</span>
                </a>
            </div>
            <div class="flex flex-1 items-center justify-end space-x-2">
                <nav class="flex items-center space-x-2">
                    <div class="hidden sm:flex items-center space-x-2 text-sm">
                        <span class="text-muted-foreground">{{ user_email }}</span>
                        {% if is_admin %}
                        <span class="badge bg-primary/10 text-primary text-xs font-semibold px-2 py-1">ADMIN</span>
                        {% endif %}
                    </div>
                    <!-- Theme Toggle Button -->
                    <button onclick="toggleTheme()" class="btn btn-icon h-9 w-9 p-0 flex items-center justify-center"
                        aria-label="Toggle theme">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="dark:hidden">
                            <circle cx="12" cy="12" r="4" />
                            <path d="M12 2v2" />
                            <path d="M12 20v2" />
                            <path d="m4.93 4.93 1.41 1.41" />
                            <path d="m17.66 17.66 1.41 1.41" />
                            <path d="M2 12h2" />
                            <path d="M20 12h2" />
                            <path d="m6.34 17.66-1.41 1.41" />
                            <path d="m19.07 4.93-1.41 1.41" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="hidden dark:block">
                            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
                        </svg>
                    </button>
                    <!-- Logout Button with Icon -->
                    <a href="{{ url_for('web.logout') }}"
                        class="inline-flex items-center justify-center h-9 w-9 rounded-md text-destructive hover:text-destructive hover:bg-destructive/20 transition-colors"
                        title="Logout" aria-label="Logout">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                            <polyline points="16 17 21 12 16 7" />
                            <line x1="21" y1="12" x2="9" y2="12" />
                        </svg>
                    </a>
                </nav>
            </div>
        </div>
    </header>
    {% endif %}

    <!-- Main Content -->
    <main class="flex-1">
        <div class="container py-6">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-muted py-2 md:py-0 mt-auto">
        <div class="container flex flex-col items-center justify-center gap-4 md:h-16 md:flex-row">
            <p class="text-center text-sm leading-loose text-muted-foreground">
                &copy; 2025 TradeX. All rights reserved. | Platform Onboarding Portal v0.1.0
            </p>
        </div>
    </footer>
    {% block extra_scripts %}{% endblock %}
</body>

</html>